{% extends 'main/profile.html' %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>New_chat</title>
</head>
<body>
{% block content %}
    <input type="hidden" value="{{ chat.pk }}" id="chat_pk">
    <input type="hidden" value="{{ request.user.username }}" id="user">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">

            </div>
            <div class="col-md-6">
                <h1>Choose a friend .</h1>
                <div class="list-group">
        {% for friend in friends %}
            <a style="color:black;font-size:20px;" class="list-group-item" href="{% url 'chat' chat.pk  %}" id="new">{{ friend.to_user }}</a>
            <input type="hidden" value="{{ friend.to_user }}" id="friend">
        {% endfor %}
                </div>
            </div>
        </div>
    </div>
    <script>
    var socket_url = 'ws://'+ window.location.host+ window.location.pathname;
    var socket = new WebSocket(socket_url);

    socket.onopen = function(event){
        document.querySelector('#new').onclick = function(e) {
            var friend_name = document.querySelector('#friend').value;
            var chat_pk = $('#chat_pk').val();
            var user = $('#user').val();
            data = {
                'friend_name':friend_name,
                'chat_pk':chat_pk,
                'user':user
            };
            socket.send((JSON.stringify(data)));
        };

    };

    socket.onclose = function(event){
        console.log('Closed...',event);
    };

    </script>

{% endblock content %}
{% block foot %}
{% endblock foot %}
</body>
</html>
